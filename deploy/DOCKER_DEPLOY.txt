â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ³ Ğ”Ğ•ĞŸĞ›ĞĞ™ Ğ§Ğ•Ğ Ğ•Ğ— DOCKER (Ğ Ğ•ĞšĞĞœĞ•ĞĞ”Ğ£Ğ•Ğ¢Ğ¡Ğ¯)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ĞŸĞ•Ğ Ğ’Ğ«Ğ™ Ğ ĞĞ— (ÑĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞ¹ Ğ’Ğ¡Ğ Ğ¸ Ğ²ÑÑ‚Ğ°Ğ²ÑŒ Ğ² Ğ²ĞµĞ±-ĞºĞ¾Ğ½ÑĞ¾Ğ»ÑŒ Timeweb):

# ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ€Ğ¾Ğ³Ğ¾ Ğ±Ğ¾Ñ‚Ğ°
systemctl stop smartfinances 2>/dev/null; systemctl disable smartfinances 2>/dev/null; pkill -9 -f "python.*main.py" 2>/dev/null; sleep 2

# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Docker ĞµÑĞ»Ğ¸ Ğ½ĞµÑ‚
if ! command -v docker &> /dev/null; then
    curl -fsSL https://get.docker.com -o get-docker.sh
    sh get-docker.sh
    rm get-docker.sh
fi

# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ docker-compose ĞµÑĞ»Ğ¸ Ğ½ĞµÑ‚
if ! command -v docker-compose &> /dev/null; then
    curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
    chmod +x /usr/local/bin/docker-compose
fi

# ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹
cd /var/www && rm -rf smartfinances && git clone https://github.com/Tue22869/Rich-Uncle-Scrooge.git smartfinances && cd smartfinances

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ google_credentials.json
cat > google_credentials.json << 'CREDEOF'
{
  "type": "service_account",
  "project_id": "rich-uncle-scrooge",
  "private_key_id": "9a8c29733c56c9ef8eb7bc53b79459ca176c5a32",
  "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQC3PuCjiGBHIsL/\nwpUlpxEE3SlxiB1BSt+MMGTY24Sm5M2svYAPhym+8eeco3LJ79ihiZSSX5SFJEnJ\nz7/fsTAbfvusqnB6CkZRKPd8oTI8HI1xD/++6lkOTQUC5AspMwKSv7Z1dCLtJyLr\nO+O0PcIa7O+2p+yMt717LMIrKzMfNU0fqtm6sk5RJ940Z9SCqC6VvgsCB2IUCpgL\nDQ94g/R/hvN98QFA5q6ksZEw4Y2VYmlTvGVclvyxKFYah/H5VSDBX6+QZ6TE2jrz\nCXfEOErMYmZapvIRu6swpqDkoSVtbYPdiBXV0iMVzf+VB7xEBeFGPBlGV27wYzzT\niJp1cSPXAgMBAAECggEAK2p239gWc5Q9XkqUetTP9/aMdK06vTcHqxfmNOkhz0cD\nogtN9Z/hGLAI37hsIIM2sOM/c8S4lCkKYInb3JyHGOSnrXu+ZXPcwCr0JC+vDsX3\nDxQq1GmCyxwddVdhe5Pt5qYMjVyET+sHX3OTmidNv4Jms0CrD5YTC0WKBZ9ZH+ni\n4YgKbu7JSiF5j7dw3jU4I/aUvm7kRDHUW4Vx7JIDMiP6w8euWdbri6q7QiYKwpl6\n4CbuaIa7A0sMbXjkivBoJjhP9uNWL4xJOB7/OiKM4Q4AmB/GfGDVEN0EUorn/KkG\njyWXs+Z2O9/4Fotq/gyB9xhBqOHZkduPkrk/LXNoKQKBgQDdM96jOZYefZgvO9t5\n6J/u6szZpmceaORQ49sprsP6EaRyrK2T4WK8qhi74j98yRjZPaM+Mm9+oMExYQdT\nxOotL8jJ4MYBUa4bmPUCSXD/4GxhV2g8vTWFjPFuHSICIXJU/TihiNHT8xyOYVmE\nT8KYdf4YKiNG0OPLcrqBy5XGfwKBgQDUEm2BLp1InaUScPoD1kg2SKCTqSMI8vkY\nRFJ+ObrWk3SabO7yQcsYo6Hk3VBVWzmBSYQJUvk2j2JCe6vc4eS/LffWRpjGi0sK\nCS746SuIW7xasWGqvB0zYuWClUHhYZQrYuq67kGzvbt91r5w6JtKiN3qJEQCeMnh\n3QligUXmqQKBgBpUh0bUnvroJkpRDLH5L7hnuJSbyyCCidLbHIZcqDVHDlUcGtlE\nddVRRfpvVvFKmquZO6o2pLDk/7oZ+55MDTftvS/Skp8rktb0IQ3xogLDOwNnPSAl\nwY4xFbfuvdKVGp/lOG159MgO4zJLgjVOrTIqsWE8+s/+I29fK7YxfpWPAoGBAMn3\nWs5iZGwZpnGvoosw8ciw1iyKMdF+BHh16NJJjIR6HdxLzixtOEyY2b+qfa0smdFl\nABgZKzoox31lZkGP6FeiIZux1CGR2r8OC+wFs+3C39jHgaomSPD9SHJaT0mjsoa3\nR7EK4wuYsAyiDPBetjX/rsgkDZkFC87MwPlNABMxAoGBAMAOkn3BRQQY4zgeh63E\nEDu1KyvG34pfXZz7BoMqfvznhGLTAfiABkOdphSxo+D4SxmwMFe0PY9pObAJBDvC\n6I+AOPsIcC+AF+Ng0PFTapYGfnzMbpFKjYpEaZChVRUFwmZ594SbwzX0D769pkpf\nNG545PZla1c4o9GWpQRcRP65\n-----END PRIVATE KEY-----\n",
  "client_email": "rich-uncle-scrooge-bot@rich-uncle-scrooge.iam.gserviceaccount.com",
  "client_id": "106694602768827482990",
  "auth_uri": "https://accounts.google.com/o/oauth2/auth",
  "token_uri": "https://oauth2.googleapis.com/token",
  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
  "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/rich-uncle-scrooge-bot%40rich-uncle-scrooge.iam.gserviceaccount.com",
  "universe_domain": "googleapis.com"
}
CREDEOF

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ .env
cat > .env << 'ENVEOF'
TELEGRAM_BOT_TOKEN=8162966420:AAGsXVW0pjy2yxoC4J5uNJaBEL7ZFY_WgSE
OPENAI_API_KEY=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
GOOGLE_APPLICATION_CREDENTIALS=/app/google_credentials.json
DATABASE_URL=sqlite:////app/data/smartfinances.db
LOG_LEVEL=INFO
ENVEOF

# Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ğ¿ĞºÑƒ Ğ´Ğ»Ñ Ğ‘Ğ”
chmod 600 google_credentials.json
chmod 644 .env
mkdir -p data

# ĞŸĞ¾Ñ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ñ‹ Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ·Ñ‹
docker stop $(docker ps -aq) 2>/dev/null || true
docker rm $(docker ps -aq) 2>/dev/null || true
docker rmi $(docker images -q smartfinances*) 2>/dev/null || true

# Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Docker
docker-compose up -d --build

# ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
sleep 5
echo ""
echo "âœ… Ğ‘ĞĞ¢ Ğ—ĞĞŸĞ£Ğ©Ğ•Ğ!"
docker-compose ps
echo ""
echo "ğŸ“Š Ğ›Ğ¾Ğ³Ğ¸:"
docker-compose logs --tail=20

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ğ•Ğ¡Ğ›Ğ˜ ĞĞ¨Ğ˜Ğ‘ĞšĞ docker-compose (KeyError, ContainerConfig Ğ¸ Ñ‚.Ğ´.):

cd /var/www/smartfinances && docker stop $(docker ps -aq) 2>/dev/null; docker rm $(docker ps -aq) 2>/dev/null; docker system prune -af; docker-compose up -d --build && sleep 3 && docker-compose logs --tail=20

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ĞĞ‘ĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ• (Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ğ°):

cd /var/www/smartfinances && git pull origin main && docker-compose up -d --build && sleep 3 && docker-compose logs --tail=20

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ĞŸĞĞ›Ğ•Ğ—ĞĞ«Ğ• ĞšĞĞœĞĞĞ”Ğ«:

# Ğ›Ğ¾Ğ³Ğ¸ Ğ±Ğ¾Ñ‚Ğ° (Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸)
cd /var/www/smartfinances && docker-compose logs -f

# ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº
cd /var/www/smartfinances && docker-compose restart

# ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°
cd /var/www/smartfinances && docker-compose down

# Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ
cd /var/www/smartfinances && docker-compose ps

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… Ğ¡ Docker Ğ±Ğ¾Ğ»ÑŒÑˆĞµ ĞĞ•Ğ¢ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼ Ñ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ğ°Ğ¼Ğ¸ Ğ¸ Ğ¿Ñ€Ğ°Ğ²Ğ°Ğ¼Ğ¸!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
